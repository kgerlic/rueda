<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <title>Odtwarzacz MP3 — Rueda de Casino</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="style.css" rel="stylesheet" type="text/css" />

  <style>
    /* Tylko dla player.html — proste UI playlisty + kontrolki */
    .player-panel{
      display: grid;
      gap: 14px;
      width: 100%;
      max-width: 820px;
      margin: 0 auto;
    }

    .tempo-row{
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .tempo-btn{
      appearance: none;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.55);
      color: var(--text-main);
      padding: 10px 12px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 650;
      letter-spacing: 0.02em;
      line-height: 1;
      user-select: none;
      white-space: nowrap;
    }
    .tempo-btn:hover{
      border-color: rgba(238, 0, 0, 0.65);
      background: rgba(238, 0, 0, 0.10);
    }
    .tempo-btn[aria-pressed="true"]{
      border-color: rgba(238, 0, 0, 0.95);
      background: rgba(238, 0, 0, 0.18);
    }

    .now-playing{
      color: var(--text-muted);
      font-size: 0.98rem;
    }

    .note{
      color: var(--text-muted);
      font-size: 0.95rem;
      margin-top: 8px;
    }

    /* Kontrolki */
    .controls{
      display: flex;
      align-items: center;
      gap: 12px;
      width: 100%;
      box-sizing: border-box;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.35);
    }

    .btn{
      appearance: none;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.55);
      color: var(--text-main);
      padding: 10px 12px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 650;
      line-height: 1;
      user-select: none;
      min-width: 110px;
      text-align: center;
    }
    .btn:hover{
      border-color: rgba(238, 0, 0, 0.65);
      background: rgba(238, 0, 0, 0.10);
    }

    .time{
      font-variant-numeric: tabular-nums;
      color: var(--text-muted);
      white-space: nowrap;
      min-width: 105px;
      text-align: right;
    }

    /* Najważniejsze: suwak ma się kurczyć w flexie */
    .seek{
      flex: 1 1 auto;
      min-width: 0;
      width: 100%;
    }

    /* Drobna optymalizacja na bardzo małych ekranach */
    @media (max-width: 420px){
      .controls{
        flex-wrap: wrap;
        gap: 10px;
      }
      .btn{
        min-width: 0;
        flex: 1 1 140px;
      }
      .time{
        flex: 1 1 100%;
        text-align: left;
        min-width: 0;
      }
    }
  </style>
</head>

<body>
  <div class="page-wrapper">
    <h2 class="page-title">
      Odtwarzacz MP3
      <a class="player-link" href="index.html" aria-label="Powrót do tabeli" title="Powrót">
        <img src="assets/icons/player.png" alt="" width="64" height="64" />
      </a>
    </h2>

    <div class="player-panel">
      <div class="tempo-row" id="tempoRow" aria-label="Wybór prędkości BPM">
        <!-- Przyciski generowane w JS -->
      </div>

      <!-- Audio bez natywnych controls (one rozjeżdżają UI na telefonie) -->
      <audio id="audio" preload="auto">
        <source id="audioSource" src="" type="audio/mpeg">
        Twoja przeglądarka nie obsługuje odtwarzacza audio.
      </audio>

      <!-- Własne kontrolki -->
      <div class="controls" aria-label="Kontrolki odtwarzacza">
        <button class="btn" id="toggleBtn" type="button">Play</button>

        <input class="seek" id="seek" type="range" min="0" max="100" value="0" aria-label="Przewijanie" />

        <div class="time" id="timeLabel">00:00 / 00:00</div>
      </div>

      <div class="now-playing" id="nowPlaying">Ładowanie…</div>

    </div>
  </div>

  <script>
    // 1) Lista dostępnych temp (dopisz/usuwaj wg plików w assets/mp3/)
    //    Nazwy plików zakładamy w formacie: "<BPM>-bpm.mp3"
    const TEMPOS = [100, 120, 140, 160, 180, 200];

    // 2) Ustaw tempo domyślne (masz na pewno 140-bpm.mp3)
    const DEFAULT_BPM = 140;

    const tempoRow = document.getElementById("tempoRow");
    const audio = document.getElementById("audio");
    const audioSource = document.getElementById("audioSource");
    const nowPlaying = document.getElementById("nowPlaying");

    const toggleBtn = document.getElementById("toggleBtn");
    const seek = document.getElementById("seek");
    const timeLabel = document.getElementById("timeLabel");

    let isSeeking = false;

    function fileFor(bpm) {
      return `assets/mp3/${bpm}-bpm.mp3`;
    }

    function setActiveButton(bpm) {
      [...tempoRow.querySelectorAll("button")].forEach(btn => {
        const isActive = Number(btn.dataset.bpm) === bpm;
        btn.setAttribute("aria-pressed", isActive ? "true" : "false");
      });
    }

    function fmtTime(sec) {
      if (!Number.isFinite(sec) || sec < 0) sec = 0;
      const m = Math.floor(sec / 60);
      const s = Math.floor(sec % 60);
      return String(m).padStart(2, "0") + ":" + String(s).padStart(2, "0");
    }

    function updateTimeUI() {
      const cur = audio.currentTime || 0;
      const dur = audio.duration || 0;

      timeLabel.textContent = `${fmtTime(cur)} / ${fmtTime(dur)}`;

      // Seek
      if (!isSeeking && dur > 0) {
        const pct = (cur / dur) * 100;
        seek.value = String(Math.min(100, Math.max(0, pct)));
      }

      // Button label
      toggleBtn.textContent = audio.paused ? "Play" : "Pause";
    }

    async function tryAutoplay() {
      try {
        await audio.play();
      } catch (e) {
        // Autoplay blocked – użytkownik musi kliknąć Play
      } finally {
        updateTimeUI();
      }
    }

    function loadTempo(bpm) {
      const src = fileFor(bpm);

      setActiveButton(bpm);
      nowPlaying.textContent = `Wybrane tempo: ${bpm} BPM — plik: ${bpm}-bpm.mp3`;

      audio.pause();
      audio.currentTime = 0;

      audioSource.src = src;
      audio.load();

      tryAutoplay();
    }

    // Budowa przycisków BPM
    TEMPOS.forEach(bpm => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "tempo-btn";
      btn.dataset.bpm = String(bpm);
      btn.setAttribute("aria-pressed", "false");
      btn.textContent = `${bpm} BPM`;

      btn.addEventListener("click", () => loadTempo(bpm));
      tempoRow.appendChild(btn);
    });

    // Play/Pause
    toggleBtn.addEventListener("click", async () => {
      if (audio.paused) {
        try {
          await audio.play();
        } catch (e) {
          // jeśli blokada, nic nie zrobimy bez interakcji (a tu interakcja jest, więc zwykle zadziała)
        }
      } else {
        audio.pause();
      }
      updateTimeUI();
    });

    // Przewijanie
    seek.addEventListener("input", () => {
      isSeeking = true;
    });

    seek.addEventListener("change", () => {
      const dur = audio.duration || 0;
      const pct = Number(seek.value);
      if (dur > 0 && Number.isFinite(pct)) {
        audio.currentTime = (pct / 100) * dur;
      }
      isSeeking = false;
      updateTimeUI();
    });

    // Aktualizacje UI
    audio.addEventListener("timeupdate", updateTimeUI);
    audio.addEventListener("durationchange", updateTimeUI);
    audio.addEventListener("play", updateTimeUI);
    audio.addEventListener("pause", updateTimeUI);
    audio.addEventListener("ended", updateTimeUI);

    // Start
    loadTempo(DEFAULT_BPM);

    // Opcjonalnie: loop
    audio.loop = true;
  </script>
</body>
</html>
